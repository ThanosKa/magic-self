---
description: General development rules for folio.sh
globs: **/*
---

# folio.sh Development Rules

## Authentication

- Always check auth status before accessing user data
- Use `auth()` from `@clerk/nextjs/server` in server components
- Use `useAuth()` from `@clerk/nextjs` in client components
- Never trust client-side user ID - always verify server-side

## Database

- Use Supabase client from server components only
- Always use the service role client for admin operations
- Never expose Supabase service role key to client
- Use parameterized queries - never concatenate SQL

## Validation

- Validate ALL inputs with Zod schemas
- Use `safeParse` and handle errors gracefully
- Never throw raw errors to UI - use toast notifications
- Export types from schema files using `z.infer<>`

## Data Fetching

- Use React Query for all async client-side state
- Prefer Server Components for initial data loading
- Use SWR pattern for data that needs real-time updates
- Never fetch in useEffect - use React Query or pass from RSC

## Error Handling

- Server: Log errors with pino logger
- Client: Show user-friendly toast messages
- Never expose stack traces or internal errors to users
- Use try/catch blocks around all async operations

## Security

- Check RLS policies are enabled on all tables
- Validate file types and sizes on upload
- Sanitize user inputs before storing
- Use HTTPS for all external requests
